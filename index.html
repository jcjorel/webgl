<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Logo - WebGL Experience</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        /* Background layer - fixed desert image */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('output/desert_background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        /* WebGL canvas layer for logo */
        #webgl-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            background: transparent;
        }

        /* Shooting stars canvas layer (independent, no mouse control) */
        #shooting-stars-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
            background: transparent;
        }

        /* Vaporwave overlay layer */
        #vaporwave-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 4;
            pointer-events: none;
            background: transparent;
        }

        /* Loading indicator */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 18px;
            z-index: 10;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body>
    <!-- Fixed background layer -->
    <div class="background"></div>
    
    <!-- WebGL canvas for 3D logo scene -->
    <canvas id="webgl-canvas"></canvas>
    
    <!-- Shooting stars canvas (independent) -->
    <canvas id="shooting-stars-canvas"></canvas>
    
    <!-- Vaporwave overlay canvas -->
    <canvas id="vaporwave-canvas"></canvas>
    
    <!-- Loading indicator -->
    <div class="loading" id="loading">Loading WebGL Experience...</div>

    <!-- Three.js and dependencies from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // Global variables for main logo scene
        let scene, camera, renderer, controls;
        let logoGroup, glassPlateMesh, logoMesh, stockText;
        
        // Separate variables for shooting stars scene (independent)
        let starsScene, starsCamera, starsRenderer;
        let shootingStars = [];
        
        // Vaporwave variables
        let vaporwaveCanvas, vaporwaveCtx, vaporwaveLines = [];
        const AMZN_STOCK_PRICE = 238.24;

        // Shooting star class
        class ShootingStar {
            constructor() {
                this.reset();
                this.geometry = new THREE.BufferGeometry();
                this.material = new THREE.LineBasicMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0,
                    linewidth: 2  // Make lines thicker for visibility
                });
                
                // Create line geometry for trail effect
                const positions = new Float32Array(6); // 2 points, 3 coordinates each
                this.geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                this.line = new THREE.Line(this.geometry, this.material);
                starsScene.add(this.line);  // Add to stars scene instead of main scene
            }

            reset() {
                // Start shooting stars from just ABOVE the background horizon line
                // The horizon in the desert image is at the mountain tops
                const startX = (Math.random() - 0.5) * 90;    // Very wide spread along horizon
                const startY = 10.5 + Math.random() * 0.5;     // Well above the mountain silhouette line
                const startZ = -55;                           // Far away at the horizon
                
                this.position = new THREE.Vector3(startX, startY, startZ);
                
                // Vanishing point is ABOVE and BEHIND the camera as per requirements
                // Stars flow from mountain horizon upward across the sky
                const vanishingX = 0;                          // Center horizontally
                const vanishingY = 20;                         // High above camera
                const vanishingZ = 30;                         // Behind the camera/viewer
                
                // Calculate direction toward vanishing point (shooting across the sky)
                const direction = new THREE.Vector3(
                    vanishingX - startX,
                    vanishingY - startY,  // Extremely steep upward trajectory from mountain line
                    vanishingZ - startZ   // Toward and past camera
                ).normalize();
                
                // Set velocity for meteor movement - "quickly" as per requirements
                const speed = 1.5 + Math.random() * 0.5; // Fast movement across sky
                this.velocity = direction.multiplyScalar(speed);
                
                this.opacity = 0;
                this.trail = [];
                this.life = 0;
                this.maxLife = 90 + Math.random() * 40; // Sufficient life to cross the sky
            }

            update() {
                this.life++;
                
                // Update position
                this.position.add(this.velocity);
                
                // Variable alpha channel depending on distance - brighter as they approach camera
                // (simulating meteors entering atmosphere and burning brighter)
                // Use starsCamera for distance calculation since stars are in separate scene
                const distanceToCamera = this.position.distanceTo(starsCamera.position);
                
                // Map distance to opacity: farther = dimmer, closer = brighter
                // Max distance ~85 units (from horizon), min distance ~15 units (passing camera)
                const maxDistance = 85;
                const minDistance = 15;
                
                // Calculate opacity based on distance (inverse relationship)
                if (distanceToCamera > maxDistance) {
                    this.opacity = 0.2; // Slightly brighter at horizon for visibility
                } else if (distanceToCamera < minDistance) {
                    this.opacity = 1.0; // Full brightness when passing near camera
                } else {
                    // Exponential interpolation for more dramatic brightening effect
                    const normalizedDistance = (distanceToCamera - minDistance) / (maxDistance - minDistance);
                    // Use power function for more dramatic brightening as stars approach
                    this.opacity = 1.0 - Math.pow(normalizedDistance, 2) * 0.8; // Range from 0.2 to 1.0
                }
                
                // Apply a minimum fade-in at the very beginning for smooth appearance
                if (this.life < 5) {
                    this.opacity *= (this.life / 5);
                }
                
                // Update trail
                this.trail.push(this.position.clone());
                if (this.trail.length > 10) {  // Longer trail
                    this.trail.shift();
                }
                
                // Update line geometry for trail effect
                if (this.trail.length >= 2) {
                    const positions = this.geometry.attributes.position.array;
                    const start = this.trail[0];
                    const end = this.trail[this.trail.length - 1];
                    
                    positions[0] = start.x; positions[1] = start.y; positions[2] = start.z;
                    positions[3] = end.x; positions[4] = end.y; positions[5] = end.z;
                    
                    this.geometry.attributes.position.needsUpdate = true;
                }
                
                // Update material opacity
                this.material.opacity = Math.max(0, Math.min(1, this.opacity));
                
                // Reset if star passes behind camera, goes below horizon, or lived too long
                if (this.position.z > 25 || this.position.y < 2 || this.life > this.maxLife) {
                    this.reset();
                }
            }
        }

        // Vaporwave line class
        class VaporwaveLine {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * window.innerWidth;
                this.width = 1 + Math.random() * 4;
                this.baseY = window.innerHeight * 0.75; // Near ground level  
                this.height = 50 + Math.random() * 150;
                this.targetOpacity = 0.2 + Math.random() * 0.4;
                this.currentOpacity = 0;
                this.growthSpeed = 0.02 + Math.random() * 0.03;
                this.currentHeight = 0;
                this.maxAge = 300 + Math.random() * 200;
                this.age = 0;
                this.color = this.getRandomVaporColor();
            }

            getRandomVaporColor() {
                const colors = [
                    'rgba(255, 0, 255,',   // Magenta
                    'rgba(0, 255, 255,',   // Cyan  
                    'rgba(255, 20, 147,',  // Deep pink
                    'rgba(138, 43, 226,'   // Blue violet
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.age++;
                
                // Grow the line
                if (this.currentHeight < this.height) {
                    this.currentHeight += this.growthSpeed * this.height;
                }
                
                // Fade in then out
                if (this.age < this.maxAge * 0.3) {
                    this.currentOpacity = Math.min(this.targetOpacity, this.currentOpacity + 0.02);
                } else if (this.age > this.maxAge * 0.7) {
                    this.currentOpacity = Math.max(0, this.currentOpacity - 0.01);
                }
                
                // Reset if too old
                if (this.age > this.maxAge) {
                    this.reset();
                }
            }

            render(ctx) {
                if (this.currentOpacity <= 0 || this.currentHeight <= 0) return;
                
                const gradient = ctx.createLinearGradient(
                    this.x, this.baseY,
                    this.x, this.baseY - this.currentHeight
                );
                
                gradient.addColorStop(0, this.color + ' 0)');  // Fully transparent at bottom
                gradient.addColorStop(1, this.color + ` ${this.currentOpacity})`); // Semi-transparent at top
                
                ctx.strokeStyle = gradient;
                ctx.lineWidth = this.width;
                ctx.lineCap = 'round';
                
                ctx.beginPath();
                ctx.moveTo(this.x, this.baseY);
                ctx.lineTo(this.x, this.baseY - this.currentHeight);
                ctx.stroke();
            }
        }

        // Initialize the application
        function init() {
            // Initialize main logo scene
            initMainScene();
            
            // Initialize separate shooting stars scene
            initStarsScene();
            
            // Setup vaporwave overlay
            setupVaporwaveCanvas();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize);
            
            // Start animation loop
            animate();
        }

        function initMainScene() {
            // Create main scene for logo
            scene = new THREE.Scene();
            
            // Create camera for main scene
            const fov = 45;
            const aspect = window.innerWidth / window.innerHeight;
            const near = 0.1;
            const far = 1000;
            camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
            camera.position.set(0, 5, 15);
            
            // Create renderer for main scene
            const canvas = document.getElementById('webgl-canvas');
            renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true,
                alpha: true,
                premultipliedAlpha: false
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0); // Transparent background
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Setup OrbitControls for main scene only
            controls = new THREE.OrbitControls(camera, canvas);
            controls.target.set(0, 0, 0);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 8;
            controls.maxDistance = 30;
            controls.maxPolarAngle = Math.PI * 0.7;
            controls.update();
            
            // Add bright ambient light for overall scene illumination
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
            
            // Add primary directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(5, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Add secondary directional light from opposite side for fill lighting
            const fillLight = new THREE.DirectionalLight(0xffffff, 0.6);
            fillLight.position.set(-5, 8, -3);
            scene.add(fillLight);
            
            // Add point light near the logo for additional illumination
            const pointLight = new THREE.PointLight(0xffffff, 0.8, 20);
            pointLight.position.set(0, 3, 8);
            scene.add(pointLight);
            
            // Create logo group
            logoGroup = new THREE.Group();
            scene.add(logoGroup);
            
            // Load AWS logo and create glass pane
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load('Amazon_Web_Services_Logo.png', function(texture) {
                createLogoAndGlass(texture);
                hideLoading();
            });
        }

        function initStarsScene() {
            // Create separate scene for shooting stars
            starsScene = new THREE.Scene();
            
            // Create fixed camera for stars (not affected by mouse controls)
            const fov = 45;
            const aspect = window.innerWidth / window.innerHeight;
            const near = 0.1;
            const far = 1000;
            starsCamera = new THREE.PerspectiveCamera(fov, aspect, near, far);
            starsCamera.position.set(0, 5, 15); // Same position as main camera
            
            // Create separate renderer for stars
            const starsCanvas = document.getElementById('shooting-stars-canvas');
            starsRenderer = new THREE.WebGLRenderer({
                canvas: starsCanvas,
                antialias: false,  // Less antialiasing for performance
                alpha: true,
                premultipliedAlpha: false
            });
            starsRenderer.setSize(window.innerWidth, window.innerHeight);
            starsRenderer.setClearColor(0x000000, 0); // Transparent background
            
            // Create shooting stars in the stars scene
            for (let i = 0; i < 5; i++) {
                shootingStars.push(new ShootingStar());
            }
            console.log('🌠 Shooting stars created:', shootingStars.length);
        }

        function createLogoAndGlass(logoTexture) {
            // Create glass plate geometry and material with light grey effect
            const glassGeometry = new THREE.PlaneGeometry(8, 6);
            const glassMaterial = new THREE.MeshPhysicalMaterial({
                transparent: true,
                opacity: 0.75,         // Higher opacity for better visibility
                roughness: 0.8,        // More diffuse for better color show-through
                metalness: 0.9,        // No metalness to show pure color
                reflectivity: 0.1,     // Minimal reflectivity
                clearcoat: 0.1,        // Minimal clearcoat
                clearcoatRoughness: 0.8,
                side: THREE.DoubleSide,
                color: 0xeffffff,       // Very light grey color
                emissive: 0x404040,   // Increased self-illumination
                emissiveIntensity: 0.3 // Higher glow for visibility
            });
            
            glassPlateMesh = new THREE.Mesh(glassGeometry, glassMaterial);
            glassPlateMesh.position.z = -0.5;
            glassPlateMesh.receiveShadow = true;
            logoGroup.add(glassPlateMesh);
            
            // Create AWS logo
            const logoGeometry = new THREE.PlaneGeometry(4, 2.4); // Maintain aspect ratio
            const logoMaterial = new THREE.MeshLambertMaterial({ 
                map: logoTexture,
                transparent: true
            });
            
            logoMesh = new THREE.Mesh(logoGeometry, logoMaterial);
            logoMesh.position.z = 0.1; // In front of glass
            logoMesh.castShadow = true;
            logoGroup.add(logoMesh);
            
            // Create stock price text
            createStockPriceText();
        }

        function createStockPriceText() {
            // Create canvas for text texture
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            
            // Draw text on canvas
            context.fillStyle = '#ffffff';
            context.font = 'bold 48px Arial';
            context.textAlign = 'center';
            context.fillText(`$${AMZN_STOCK_PRICE}`, canvas.width / 2, canvas.height / 2 + 16);
            
            // Create texture from canvas
            const textTexture = new THREE.CanvasTexture(canvas);
            
            // Create text mesh
            const textGeometry = new THREE.PlaneGeometry(3, 0.75);
            const textMaterial = new THREE.MeshBasicMaterial({ 
                map: textTexture,
                transparent: true
            });
            
            stockText = new THREE.Mesh(textGeometry, textMaterial);
            stockText.position.set(0, -2, 0.1); // Below logo
            logoGroup.add(stockText);
        }

        function setupVaporwaveCanvas() {
            vaporwaveCanvas = document.getElementById('vaporwave-canvas');
            vaporwaveCtx = vaporwaveCanvas.getContext('2d');
            
            // Set canvas size
            vaporwaveCanvas.width = window.innerWidth;
            vaporwaveCanvas.height = window.innerHeight;
            
            // Create initial vaporwave lines
            for (let i = 0; i < 15; i++) {
                vaporwaveLines.push(new VaporwaveLine());
            }
        }

        function updateVaporwaveEffect() {
            // Clear canvas
            vaporwaveCtx.clearRect(0, 0, vaporwaveCanvas.width, vaporwaveCanvas.height);
            
            // Update and render lines
            vaporwaveLines.forEach(line => {
                line.update();
                line.render(vaporwaveCtx);
            });
            
            // Randomly add new lines
            if (Math.random() < 0.02 && vaporwaveLines.length < 20) {
                vaporwaveLines.push(new VaporwaveLine());
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Update controls for main scene
            controls.update();
            
            // Rotate logo group slowly
            if (logoGroup) {
                logoGroup.rotation.y += 0.001;
            }
            
            // Update shooting stars
            shootingStars.forEach(star => star.update());
            
            // Update vaporwave effect
            updateVaporwaveEffect();
            
            // Render main scene (logo)
            renderer.render(scene, camera);
            
            // Render stars scene (independent, no mouse control)
            if (starsRenderer && starsScene && starsCamera) {
                starsRenderer.render(starsScene, starsCamera);
            }
        }

        function onWindowResize() {
            // Update main camera
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            
            // Update main renderer
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // Update stars camera
            if (starsCamera) {
                starsCamera.aspect = window.innerWidth / window.innerHeight;
                starsCamera.updateProjectionMatrix();
            }
            
            // Update stars renderer
            if (starsRenderer) {
                starsRenderer.setSize(window.innerWidth, window.innerHeight);
            }
            
            // Update vaporwave canvas
            vaporwaveCanvas.width = window.innerWidth;
            vaporwaveCanvas.height = window.innerHeight;
        }

        function hideLoading() {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.opacity = '0';
                setTimeout(() => loading.remove(), 1000);
            }
        }

        // Start the application
        window.addEventListener('load', init);
        
        // Debug info
        console.log('🚀 AWS Logo WebGL Experience');
        console.log('📊 AMZN Stock Price: $' + AMZN_STOCK_PRICE);
        console.log('🎮 Use mouse to orbit around the logo');
        console.log('⭐ Watch for shooting stars in the sky');
        console.log('🌈 Vaporwave effects appear near the ground');
    </script>
</body>
</html>
